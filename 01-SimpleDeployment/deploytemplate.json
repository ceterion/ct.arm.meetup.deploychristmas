{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {},
    "variables": {},
    "resources": [
       {
           "type": "Microsoft.Storage/storageAccounts",
           "name": "[toLower('ffvm01storage')]",
           "apiVersion": "2015-06-15",
           "location": "[resourceGroup().location]",
           "tags": {
               "displayName": "ffvm01 Storage Account"
           },
           "properties": {
               "accountType": "Standard_LRS"
           }
       },
       {
           "apiVersion": "2015-06-15",
           "type": "Microsoft.Network/publicIPAddresses",
           "name": "ffvm01-PublicIP",
           "location": "[resourceGroup().location]",
           "tags": {
               "displayName": "PublicIPAddress"
           },
           "properties": {
               "publicIPAllocationMethod": "Dynamic",
               "dnsSettings": {
                   "domainNameLabel": "[toLower('ffvm01')]"
               }
           }
       },
       {
           "apiVersion": "2017-06-01",
           "type": "Microsoft.Network/virtualNetworks",
           "name": "VirtualNetwork",
           "resourceGroup": "Network",
           "location": "[resourceGroup().location]",
           "tags": {
               "displayName": "VirtualNetwork"
           },
           "properties": {
               "addressSpace": {
                   "addressPrefixes": [
                       "10.0.0.0/16"
                   ]
               },
               "subnets": [
                   {
                       "name": "Subnet1",
                       "properties": {
                           "addressPrefix": "10.0.0.0/24"
                       }
                   }
               ]
           }
       },
       {
           "apiVersion": "2017-05-10",
           "type": "Microsoft.Network/networkInterfaces",
           "name": "ffvm01-NetworkInterface",
           "location": "[resourceGroup().location]",
           "resourceGroup": "",
           "dependsOn": [
               "Microsoft.Network/publicIPAddresses/ffvm01-PublicIP",
               "Microsoft.Network/virtualNetworks/ffvm01-VirtualNetwork"
           ],
           "tags": {
               "displayName": "ffvm01 Network Interface"
           },
           "properties": {
               "ipConfigurations": [
                   {
                       "name": "ipconfig1",
                       "properties": {
                           "privateIPAllocationMethod": "Dynamic",
                           "publicIPAddress": {
                               "id": "[resourceId('Microsoft.Network/publicIPAddresses', 'ffvm01-PublicIP')]"
                           },
                           "subnet": {
                               "id": "[concat(resourceId('Microsoft.Network/virtualNetworks', 'ffvm01-VirtualNetwork'), '/subnets/ffvm01-VirtualNetwork-Subnet')]"
                           }
                       }
                   }
               ]
           }
       },
       {
           "apiVersion": "2017-03-30",
           "type": "Microsoft.Compute/virtualMachines",
           "name": "ffvm01",
           "location": "[resourceGroup().location]",
           "dependsOn": [
               "[concat('Microsoft.Storage/storageAccounts/', toLower('ffvm01storage'))]",
               "Microsoft.Network/networkInterfaces/ffvm01-NetworkInterface"
           ],
           "tags": {
               "displayName": "ffvm01"
           },
           "properties": {
               "hardwareProfile": {
                   "vmSize": "Standard_A2"
               },
               "osProfile": {
                   "computerName": "ffvm01",
                   "adminUsername": "Fabian",
                   "adminPassword": "MeinPasswort123!"
               },
               "storageProfile": {
                   "imageReference": {
                       "publisher": "MicrosoftWindowsServer",
                       "offer": "WindowsServer",
                       "sku": "2012-R2-Datacenter",
                       "version": "latest"
                   },
                   "osDisk": {
                       "name": "ffvm01OSDisk",
                       "caching": "ReadWrite",
                       "createOption": "FromImage"
                   }
               },
               "networkProfile": {
                   "networkInterfaces": [
                       {
                           "id": "[resourceId('Microsoft.Network/networkInterfaces', 'ffvm01-NetworkInterface')]"
                       }
                   ]
               },
               "diagnosticsProfile": {
                   "bootDiagnostics": {
                       "enabled": true,
                       "storageUri": "[concat('http://', toLower('ffvm01storage'), '.blob.core.windows.net')]"
                   }
               }
           },
           "resources": [
               {
                   "type": "extensions",
                   "name": "ffvm01AzureDiagnostics",
                   "apiVersion": "2015-06-15",
                   "location": "[resourceGroup().location]",
                   "tags": {
                       "displayName": "ffvm01AzureDiagnostics"
                   },
                   "dependsOn": [
                       "Microsoft.Compute/virtualMachines/ffvm01"
                   ],
                   "properties": {
                       "publisher": "Microsoft.Azure.Diagnostics",
                       "type": "IaaSDiagnostics",
                       "typeHandlerVersion": "1.5",
                       "autoUpgradeMinorVersion": true,
                       "settings": {
                           "xmlCfg": "[base64('<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <Logs scheduledTransferPeriod=\"PT1M\" scheduledTransferLogLevelFilter=\"Error\" /> <Directories scheduledTransferPeriod=\"PT1M\"> <IISLogs containerName =\"wad-iis-logfiles\" /> <FailedRequestLogs containerName =\"wad-failedrequestlogs\" /> </Directories> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*\" /> </WindowsEventLog> <CrashDumps containerName=\"wad-crashdumps\" dumpType=\"Mini\"> <CrashDumpConfiguration processName=\"WaIISHost.exe\"/> <CrashDumpConfiguration processName=\"WaWorkerHost.exe\"/> <CrashDumpConfiguration processName=\"w3wp.exe\"/> </CrashDumps> <PerformanceCounters scheduledTransferPeriod=\"PT1M\"> <PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available MBytes\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\Web Service(_Total)\\ISAPI Extension Requests/sec\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\Web Service(_Total)\\Bytes Total/Sec\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\ASP.NET Applications(__Total__)\\Requests/Sec\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\ASP.NET Applications(__Total__)\\Errors Total/Sec\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\ASP.NET\\Requests Queued\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\ASP.NET\\Requests Rejected\" sampleRate=\"PT3M\" /> <PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT3M\" /> </PerformanceCounters> </DiagnosticMonitorConfiguration> </WadCfg>')]",
                           "storageAccount": "[toLower('ffvm01storage')]"
                       },
                       "protectedSettings": {
                           "storageAccountName": "[toLower('ffvm01storage')]",
                           "storageAccountKey": "[listkeys(concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Storage/storageAccounts/', toLower('ffvm01storage')), '2015-06-15').key1]",
                           "storageAccountEndPoint": "https://core.windows.net"
                       }
                   }
               }
           ]
       }
    ],
    "outputs": {}
}